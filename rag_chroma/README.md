# RAG ChromaDB 交互式命令行工具

一个基于 ChromaDB 和 SiliconFlow 嵌入模型的交互式 RAG (检索增强生成) 命令行工具。

## 功能特性

- 🚀 **交互式界面**: 基于数字选择的友好命令行界面
- 📄 **多格式支持**: 支持 PDF、TXT、MD 文件和直接文本输入
- 🔍 **智能检索**: 支持向量搜索 + 重排序的两阶段检索
- 🎯 **重排序模型**: 集成 SiliconFlow 重排序模型，显著提高检索准确性
- ⚙️ **灵活配置**: 可配置的嵌入模型、重排序模型、分块策略等
- 🗑️ **文档管理**: 支持添加、删除、替换文档
- 📊 **状态监控**: 查看知识库状态和统计信息

## 安装步骤

### 1. 环境要求
- Python >= 3.9
- ChromaDB 服务器运行在 localhost:8002 (或其他配置的地址)

### 2. 安装依赖

```bash
# 进入项目目录
cd rag_chroma

# 安装依赖包
pip install -r requirements.txt
```

### 3. 环境变量配置

设置 SiliconFlow API Key:

```bash
export SILICONFLOW_API_KEY="your_api_key_here"
```

或者在运行时手动输入。

### 4. 启动 ChromaDB 服务器

```bash
# 使用 Docker 启动 ChromaDB 服务器
docker run -p 8002:8000 chromadb/chroma:latest
```

## 使用方法

### 启动交互式界面

```bash
python run.py
```

### 主要功能

1. **初始化知识库**: 创建或连接到 ChromaDB 集合
2. **添加文档**:
   - 从文件路径添加 (支持 PDF/TXT/MD)
   - 直接输入文本内容
3. **智能检索**:
   - 传统向量搜索
   - 两阶段检索 (向量搜索 + 重排序)
   - 支持多种重排序模型
4. **查看状态**: 显示知识库配置和统计信息
5. **删除文档**: 根据来源名称删除文档
6. **配置设置**: 修改服务器地址、模型参数等

### 使用示例

1. 启动程序后，首先选择 `1` 初始化知识库
2. 输入知识库名称 (如: `my_knowledge_base`)
3. 选择 `2` 添加文档，输入文件路径
4. 选择 `4` 进行智能检索：
   - 输入查询文本
   - 选择是否使用重排序 (推荐选择 "是")
   - 选择重排序模型 (推荐使用默认的 BGE 模型)

## 重排序功能详解

### 🎯 什么是重排序？

重排序是一种两阶段检索策略：

1. **第一阶段 - 粗排**: 使用向量搜索快速筛选候选文档
2. **第二阶段 - 精排**: 使用重排序模型对候选文档进行精确排序

### 📊 效果对比

| 检索方式 | 速度 | 准确性 | 适用场景 |
|---------|------|--------|----------|
| 纯向量搜索 | 快 | 中等 | 简单查询 |
| 向量+重排序 | 中等 | 高 | 复杂查询 |

### 🤖 支持的重排序模型

- **BAAI/bge-reranker-v2-m3** (推荐): 平衡性能和准确性
- **Pro/BAAI/bge-reranker-v2-m3**: 更高精度版本
- **Qwen/Qwen3-Reranker-8B**: 最高精度，适合学术研究
- **Qwen/Qwen3-Reranker-4B**: 中等精度，平衡选择
- **Qwen/Qwen3-Reranker-0.6B**: 快速推理，适合实时应用

### 💡 使用建议

- 对于重要查询，建议使用重排序功能
- 初始检索建议设置为最终结果的 3-5 倍
- 根据延迟要求选择合适的重排序模型

## 配置选项

### 嵌入模型配置
- **模型**: `Qwen/Qwen3-Embedding-8B` (默认)
- **向量维度**: 1024 (默认)
- **批处理大小**: 32 (默认)

### 分块策略
- **分块大小**: 1000 字符 (默认)
- **重叠大小**: 100 字符 (默认)

### 服务器配置
- **主机**: localhost (默认)
- **端口**: 8002 (默认)

## 故障排除

### 常见问题

1. **ModuleNotFoundError: No module named 'redis'**
   ```bash
   pip install redis
   ```

2. **KeyError: '_type'**
   - 确保使用最新版本的 langchain-chroma
   - 检查 ChromaDB 服务器版本兼容性

3. **API Key 错误**
   - 确保设置了正确的 SILICONFLOW_API_KEY
   - 检查 API Key 是否有效

4. **连接 ChromaDB 失败**
   - 确保 ChromaDB 服务器正在运行
   - 检查主机和端口配置

### 版本兼容性

- ChromaDB: >= 0.5.0, < 0.6.0
- LangChain: >= 0.2.15, < 0.3.0
- langchain-chroma: >= 0.1.0, < 0.2.0

## 更新日志

### v1.0.0
- 初始版本发布
- 支持交互式命令行界面
- 集成 SiliconFlow 嵌入模型
- 支持多种文档格式
- 基本的 CRUD 操作

## 贡献

欢迎提交 Issue 和 Pull Request！

## 许可证

MIT License
